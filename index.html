<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>PSV v4 + Pins</title>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.124/build/three.min.js"></script>

  <!-- 依存ライブラリ -->
  <script src="https://cdn.jsdelivr.net/npm/uevent@2/browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dot/doT.min.js"></script>

  <!-- Photo-Sphere-Viewer v4 本体 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>

  <!-- ★ Markers プラグイン -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/plugins/markers.css">
  <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/plugins/markers.js"></script>

  <style>
    html,body{margin:0;height:100%}
    #viewer{width:100%;height:100%}
  </style>
</head>
<body>
  <div id="viewer"></div>

  <script>
    // 1) ビューア生成（あなたの pano 名は SD12F.jpg ）
    const viewer = new PhotoSphereViewer.Viewer({
      container : document.getElementById('viewer'),
      panorama  : 'sphere30m.jpg',
      loadingTxt: 'ロード中…'
    });

    // 2) Markers プラグインを取得
    const markers = viewer.getPlugin(PhotoSphereViewer.MarkersPlugin);

    // 3) ピン（マーカー）追加
    //   - position は { yaw, pitch }（単位：rad or 'deg' 文字列）
    //   - image を指定しなければデフォルトの点マーカーも使えるけど、
    //     ここでは見やすい丸ピンっぽい SVG を使います（CDN）
    const pinIcon = 'https://cdn.jsdelivr.net/gh/photo-sphere-viewer/photo-sphere-viewer@4/assets/pin-red.svg';

    markers.addMarker({
      id: 'pin-1',
      image: pinIcon,
      size: { width: 48, height: 48 },
      anchor: 'bottom center',
      position: { yaw: '20deg', pitch: '-5deg' }, // ←位置はあとで調整を
      tooltip: '① 写真を見る（1.jpg）',
      data: { url: './1.jpg', type: 'image' }
    });

    markers.addMarker({
      id: 'pin-2',
      image: pinIcon,
      size: { width: 300, height: 300 },
      anchor: 'bottom center',
      position: { yaw: '-45deg', pitch: '-10deg' },
      tooltip: '② 動画を見る（1.mp4）',
      data: { url: './1.mp4', type: 'video' }
    });

    markers.addMarker({
      id: 'pin-3',
      image: pinIcon,
      size: { width: 48, height: 48 },
      anchor: 'bottom center',
      position: { yaw: '120deg', pitch: '8deg' },
      tooltip: '③ 写真を見る（2.jpg）',
      data: { url: './2.jpg', type: 'image' }
    });

    // 4) クリックで新規タブを開く
    markers.on('select-marker', (e, marker) => {
      const url = marker.config.data && marker.config.data.url;
      if (url) window.open(url, '_blank');
    });

    // 5) 置き場所（yaw/pitch）を拾うためのデバッガ
    //    画面をクリックした地点の yaw/pitch をコンソールに出します。
    viewer.on('click', (e, data) => {
      // data.yaw / data.pitch はラジアンなので deg も表示
      const yawDeg   = (data.yaw   * 180 / Math.PI).toFixed(1);
      const pitchDeg = (data.pitch * 180 / Math.PI).toFixed(1);
      console.log(`yaw: ${yawDeg}deg, pitch: ${pitchDeg}deg`);
    });
  </script>
</body>
</html>



