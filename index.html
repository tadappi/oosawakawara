<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>PSV v4 + Pins</title>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.124/build/three.min.js"></script>

  <!-- 依存ライブラリ（v4は必須） -->
  <script src="https://cdn.jsdelivr.net/npm/uevent@2/browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dot/doT.min.js"></script>

  <!-- Photo-Sphere-Viewer v4 本体 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>

  <!-- Markers プラグイン -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/plugins/markers.css">
  <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4/dist/plugins/markers.js"></script>

  <style>
    html,body{margin:0;height:100%}
    #viewer{width:100%;height:100%}
  </style>
</head>
<body>
  <div id="viewer"></div>

  <script>
    // 1) ビューア生成（★plugins に Markers を渡すのがポイント）
    const viewer = new PhotoSphereViewer.Viewer({
      container : document.getElementById('viewer'),
      panorama  : 'sphere30m.jpg',             // ← 天球画像（リポジトリ直下）
      loadingTxt: 'ロード中…',
      plugins   : [ PhotoSphereViewer.MarkersPlugin ]
    });

    // 2) 準備完了後にピンを追加
    viewer.once('ready', () => {
      const markers = viewer.getPlugin(PhotoSphereViewer.MarkersPlugin);

      // 好きなアイコン（SVG/PNG）。見失いにくい赤ピンを使います
      const pinIcon = 'https://cdn.jsdelivr.net/gh/photo-sphere-viewer/photo-sphere-viewer@4/assets/pin-red.svg';

      // ピン1：画像 1.jpg を新規タブ
      markers.addMarker({
        id: 'pin-1',
        image: pinIcon,
        size: { width: 96, height: 96 },     // 見えづらければ 148 にしてOK
        anchor: 'bottom center',
        position: { yaw: '20deg', pitch: '-5deg' }, // ←位置はあとで調整
        tooltip: '① 写真を見る（1.jpg）',
        data: { url: './1.jpg', type: 'image' }
      });

      // ピン2：動画 1.mp4 を新規タブ（GitHub Pagesならブラウザ再生されます）
      markers.addMarker({
        id: 'pin-2',
        image: pinIcon,
        size: { width: 96, height: 96 },
        anchor: 'bottom center',
        position: { yaw: '-45deg', pitch: '-10deg' },
        tooltip: '② 動画を見る（1.mp4）',
        data: { url: './1.mp4', type: 'video' }
      });

      // ピン3：画像 2.jpg
      markers.addMarker({
        id: 'pin-3',
        image: pinIcon,
        size: { width: 96, height: 96 },
        anchor: 'bottom center',
        position: { yaw: '120deg', pitch: '8deg' },
        tooltip: '③ 写真を見る（2.jpg）',
        data: { url: './2.jpg', type: 'image' }
      });

      // クリックで新規タブを開く
      markers.on('select-marker', (e, marker) => {
        const url = marker.config.data && marker.config.data.url;
        if (url) window.open(url, '_blank');
      });
    });

    // 3) クリック地点の yaw/pitch をコンソール出力（位置合わせ用）
    viewer.on('click', (e, data) => {
      const yawDeg   = (data.yaw   * 180 / Math.PI).toFixed(1);
      const pitchDeg = (data.pitch * 180 / Math.PI).toFixed(1);
      console.log(`yaw: ${yawDeg}deg, pitch: ${pitchDeg}deg`);
    });
  </script>
</body>
</html>


